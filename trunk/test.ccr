<resolver>
	<actions>
		<action>
			<name>move to</name>
			<inworld language="javascript">
			<![CDATA[
				var vector = argv[0];
				myLogger.message("Resolver got Move To command for id(" + subject.id() + "): " + vector[0] + " " + vector[1] + " " + vector[2] + "\n", false);
				subject.setPosition(vector);
				subject.changed = true;
			]]>
			</inworld>
			<inrepresentation language="javascript">
			<![CDATA[
				representation.updateLocation(subject);
			]]>
			</inrepresentation>
		</action>
		<action>
			<name>move</name>
			<inworld language="javascript">
			<![CDATA[
				var type = argv[0];
				var dvector = argv[1];
				if(type == Constants.MOVE_RELATIVE_TO_FACING)
				{
					dvector = Quaternions.rotatePoint(dvector,subject.getFacing());
				}

				var vector = subject.getPosition();
				for(i = 0; i < dvector.length; i++)
				{
					vector[i] += dvector[i];
				}
				subject.setPosition(vector);
				subject.changed = true;
			]]>
			</inworld>
			<inrepresentation language="javascript">
			<![CDATA[
				representation.updateLocation(subject);
			]]>
			</inrepresentation>
		</action>
		<action>
			<name>rotate to</name>
			<inworld language="javascript">
			<![CDATA[
				var vector = argv[0];
				myLogger.message("Resolver got Rotate To command for id(" + subject.id() + "): " + vector[0] + " " + vector[1] + " " + vector[2] + " " + vector[3] + "\n", false);
				subject.setFacing(vector);
				subject.changed = true;
			]]>
			</inworld>
			<inrepresentation language="javascript">
			<![CDATA[
				representation.updateLocation(subject);
			]]>
			</inrepresentation>
		</action>
		<action>
			<name>rotate</name>
			<inworld language="javascript">
			<![CDATA[
				var q = argv[0];
				var facing = Quaternions.mul(subject.getFacing(),q);
				subject.setFacing(facing);
				subject.changed = true;
			]]>
			</inworld>
			<inrepresentation language="javascript">
			<![CDATA[
				representation.updateLocation(subject);
			]]>
			</inrepresentation>
		</action>
	</actions>
	<rules>
		<rule>
			<verb>move</verb>
			<function language="javascript">
			<![CDATA[
				var status = Constants.SUCCESS;
				for(var i = 0; i < relevant.length; i++)
				{
					if(relevant.get(i).isColliding(subject))
						myLogger.message("Collision!" + relevant.get(i).id() + " " + subject.id() + "\n", true);
				}
				var a = myActions.get("move").get(0);
				var parameters = new Array(1);

				var type = argv[0];
				var dvector = argv[1];
				if(type == Constants.MOVE_RELATIVE_TO_FACING)
				{
					dvector = Quaternions.rotatePoint(dvector,subject.getFacing());
				}
				var vector = subject.copyPosition();
				for(i = 0; i < dvector.length; i++)
				{
					vector[i] += dvector[i];
				}
				parameters[0] = vector;

				actionsToSend.add("move to", a.getNouns(), parameters);
			]]>
			</function>
		</rule>
		<rule>
			<verb>rotate</verb>
			<function language="javascript">
			<![CDATA[
				var status = Constants.SUCCESS;
				var q = argv[0];

				if(q.length != 4)
				{
					myLogger.message("Bad Quaternion length. Bad!\n", true);
					status = Constants.ERROR;
				}
				else
				{

					facing = Quaternions.mul(subject.getFacing(),q);

					myLogger.message("Facing length= "+Quaternions.getLength(facing)+"\n",false);
					var a = myActions.get("rotate").get(0);
					var parameters = new Array(1);
					parameters[0] = facing;

					actionsToSend.add("rotate to", a.getNouns(), parameters);
				}
			]]>
			</function>
		</rule>
	</rules>
</resolver>
